{% extends "base.html" %}

{% block title %}Lista de Pe√ßas{% endblock %}

{% block content %}
<h2>Lista de Pe√ßas / Varia√ß√µes</h2>

{# Formul√°rio de Busca (envia via GET para a mesma p√°gina) #}
<form action="/pecas" method="get" style="background-color: #e9ecef;">
    <label for="search">Buscar Pe√ßa:</label>
    <div style="display: flex; gap: 10px;">
        <input type="text" id="search" name="search" placeholder="SKU, Descri√ß√£o, OEM..." value="{{ search_term or '' }}" style="flex-grow: 1;">
        <button type="submit">Buscar</button>
        {% if search_term %}
        <a href="/pecas" style="padding: 10px 15px; background-color: #6c757d; color: white; text-decoration: none; border-radius: 4px;">Limpar</a>
        {% endif %}
    </div>
</form>

{# Bot√£o para ir para a p√°gina de adicionar nova pe√ßa #}
<div style="margin-bottom: 20px; text-align: right;">
    <a href="/pecas/nova" style="padding: 10px 20px; background-color: #28a745; color: white; text-decoration: none; border-radius: 4px;">+ Adicionar Nova Varia√ß√£o</a>
    <a href="/montadoras" style="padding: 10px 15px; background-color: #6c757d; color: white; text-decoration: none; border-radius: 4px; margin-left: 10px;">Gerenciar Montadoras</a>

</div>


{# Exibe erro se houver problema ao carregar a lista #}
{% if error_message %}
    <p class="error">{{ error_message }}</p>
{% endif %}

{# Tabela com a lista de pe√ßas #}
<div style="overflow-x: auto;"> {# Permite rolagem horizontal em telas pequenas #}
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr style="background-color: #e9ecef; border-bottom: 2px solid #ccc;">
                <th style="padding: 10px; text-align: left;">SKU Varia√ß√£o</th>
                <th style="padding: 10px; text-align: left;">Descri√ß√£o</th>
                <th style="padding: 10px; text-align: left;">SKU Base</th>
                <th style="padding: 10px; text-align: left;">OEM</th>
                <th style="padding: 10px; text-align: center;">Estoque</th>
                <th style="padding: 10px; text-align: center;">P/ Reparar</th>
                <th style="padding: 10px; text-align: right;">Pre√ßo Venda</th>
                <th style="padding: 10px; text-align: center;">A√ß√µes</th> {# Coluna para bot√µes futuros #}
            </tr>
        </thead>
        <tbody>
            {% for peca in pecas %}
            <tr>
                <td style="padding: 8px;">{{ peca.sku_variacao }}</td>
                <td style="padding: 8px;">{{ peca.descricao_peca | truncate(60) }}</td> {# Limita tamanho da descri√ß√£o #}
                <td style="padding: 8px;">{{ peca.codigo_base }}</td>
                <td style="padding: 8px;">{{ peca.codigo_oem or '-' }}</td>
                <td style="padding: 8px; text-align: center;">{{ peca.quantidade_estoque }}</td>
                <td style="padding: 8px; text-align: center;">{{ peca.qtd_para_reparar }}</td>
                <td style="padding: 8px; text-align: right;">R$ {{ "%.2f"|format(peca.preco_venda|float) if peca.preco_venda is not none else '-' }}</td>
                <td style="padding: 8px; text-align: center;">
                    {# Adicionar bot√µes de Editar/Detalhes/Etiqueta aqui depois #}
                    <a href="#" title="Ver Detalhes (N√£o implementado)">üëÅÔ∏è</a>
                    <a href="#" title="Editar (N√£o implementado)">‚úèÔ∏è</a>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="8" style="padding: 20px; text-align: center; font-style: italic;">
                    {% if search_term %}
                        Nenhuma pe√ßa encontrada para "{{ search_term }}".
                    {% else %}
                        Nenhuma pe√ßa cadastrada ainda. <a href="/pecas/nova">Adicionar a primeira?</a>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{# Pagina√ß√£o (Simples - Adicionar l√≥gica completa depois) #}
{# <div style="margin-top: 20px; text-align: center;">
    {% if skip > 0 %}
        <a href="/pecas?skip={{ [0, skip - limit] | max }}&limit={{ limit }}{% if search_term %}&search={{ search_term }}{% endif %}">Anterior</a>
    {% endif %}
    <span>P√°gina {{ (skip // limit) + 1 }}</span>
    {% if pecas | length == limit %}
         <a href="/pecas?skip={{ skip + limit }}&limit={{ limit }}{% if search_term %}&search={{ search_term }}{% endif %}">Pr√≥xima</a>
    {% endif %}
</div> #}

{% endblock %}
