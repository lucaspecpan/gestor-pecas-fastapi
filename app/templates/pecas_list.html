{% extends "base.html" %}

{% block title %}Lista de Pe√ßas{% endblock %}

{% block content %}
<h2>Lista de Pe√ßas / Varia√ß√µes</h2>

{# Formul√°rio de Busca #}
<form action="/pecas" method="get" style="background-color: #e9ecef; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
    <label for="search" style="margin-bottom: 5px;">Buscar Pe√ßa:</label>
    <div style="display: flex; gap: 10px; align-items: center;">
        <input type="text" id="search" name="search" placeholder="SKU, Descri√ß√£o, OEM, Categoria..." value="{{ search_term or '' }}" style="flex-grow: 1; margin-bottom: 0;">
        <button type="submit" style="padding: 10px 15px;">Buscar</button>
        {% if search_term %}
        <a href="/pecas" style="padding: 10px 15px; background-color: #6c757d; color: white; text-decoration: none; border-radius: 4px; white-space: nowrap;">Limpar Busca</a>
        {% endif %}
    </div>
</form>

{# Bot√µes de A√ß√£o #}
<div style="margin-bottom: 20px; text-align: right;">
    <a href="/pecas/nova" style="padding: 10px 20px; background-color: #28a745; color: white; text-decoration: none; border-radius: 4px;">+ Adicionar Varia√ß√£o</a>
    <a href="/montadoras" style="padding: 10px 15px; background-color: #6c757d; color: white; text-decoration: none; border-radius: 4px; margin-left: 10px;">Gerenciar Montadoras</a>
</div>

{# Mensagem de Erro #}
{% if error_message %} <p class="error">{{ error_message }}</p> {% endif %}

{# Tabela #}
<div style="overflow-x: auto;">
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr style="background-color: #dee2e6; border-bottom: 2px solid #adb5bd;">
                <th style="padding: 10px; text-align: left;">SKU Varia√ß√£o</th>
                <th style="padding: 10px; text-align: left;">Descri√ß√£o</th>
                <th style="padding: 10px; text-align: left;">Categoria</th> {# NOVA COLUNA #}
                <th style="padding: 10px; text-align: left;">SKU Base</th>
                <th style="padding: 10px; text-align: left;">OEM</th>
                <th style="padding: 10px; text-align: center;">Estoque</th>
                <th style="padding: 10px; text-align: center;">P/ Reparar</th>
                <th style="padding: 10px; text-align: right;">Pre√ßo Venda</th>
                <th style="padding: 10px; text-align: center;">A√ß√µes</th>
            </tr>
        </thead>
        <tbody>
            {% for peca in pecas %}
            <tr style="border-bottom: 1px solid #eee;">
                <td style="padding: 8px;">{{ peca.sku_variacao }}</td>
                <td style="padding: 8px;">{{ peca.descricao_peca | truncate(50) }}</td> {# Limita tamanho #}
                <td style="padding: 8px;">{{ peca.categoria or '-' }}</td> {# EXIBE CATEGORIA #}
                <td style="padding: 8px;">{{ peca.codigo_base }}</td>
                <td style="padding: 8px;">{{ peca.codigo_oem or '-' }}</td>
                <td style="padding: 8px; text-align: center;">{{ peca.quantidade_estoque }}</td>
                <td style="padding: 8px; text-align: center;">{{ peca.qtd_para_reparar }}</td>
                <td style="padding: 8px; text-align: right;">R$ {{ "%.2f"|format(peca.preco_venda|float) if peca.preco_venda is not none else '-' }}</td>
                <td style="padding: 8px; text-align: center;">
                    {# Adicionar links/bot√µes reais depois #}
                    <a href="#" title="Ver Detalhes (Futuro)">üëÅÔ∏è</a>
                    <a href="#" title="Editar (Futuro)">‚úèÔ∏è</a>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="9" style="padding: 20px; text-align: center; font-style: italic;"> {# Ajustado colspan #}
                    {% if search_term %} Nenhuma pe√ßa encontrada para "{{ search_term }}".
                    {% else %} Nenhuma pe√ßa cadastrada. <a href="/pecas/nova">Adicionar?</a> {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{# Pagina√ß√£o (Placeholder) #}
{# <div style="margin-top: 20px; text-align: center;"> ... </div> #}

{% endblock %}
